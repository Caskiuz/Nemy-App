# Sistema de Botones Inteligentes para Estados de Pedidos\n\n## DescripciÃ³n\n\nEl sistema de botones inteligentes proporciona una interfaz adaptativa que muestra informaciÃ³n contextual y acciones apropiadas segÃºn el estado actual de un pedido y el rol del usuario.\n\n## CaracterÃ­sticas Principales\n\n### ğŸ§  Inteligencia Contextual\n- **InformaciÃ³n automÃ¡tica**: Los botones muestran automÃ¡ticamente quÃ© estÃ¡ pasando con el pedido\n- **PrÃ³ximos pasos**: Indican claramente quÃ© acciÃ³n se necesita para avanzar\n- **Dependencias**: Alertan cuando se requiere acciÃ³n de otros actores (negocio, cliente)\n\n### ğŸ¯ Estados Soportados\n\n| Estado | DescripciÃ³n | AcciÃ³n del Repartidor | InformaciÃ³n Mostrada |\n|--------|-------------|----------------------|---------------------|\n| `pending` | Esperando confirmaciÃ³n | âŒ No puede actuar | \"El negocio debe aceptar el pedido\" |\n| `confirmed` | Pedido aceptado | âŒ No puede actuar | \"El negocio iniciarÃ¡ la preparaciÃ³n\" |\n| `preparing` | En preparaciÃ³n | âŒ No puede actuar | \"Espera a que estÃ© listo para recoger\" |\n| `ready` | Listo para recoger | âœ… Puede recoger | \"Ve al negocio y recoge el pedido\" |\n| `picked_up` | Pedido recogido | âœ… Puede continuar | \"DirÃ­gete hacia el cliente\" |\n| `on_the_way` | En camino | âœ… Puede entregar | \"Entrega el pedido al cliente\" |\n| `in_transit` | En trÃ¡nsito | âœ… Puede entregar | \"Entrega el pedido al cliente\" |\n| `delivered` | Entregado | âŒ Completado | \"Â¡Entrega completada!\" |\n| `cancelled` | Cancelado | âŒ Cancelado | \"Este pedido fue cancelado\" |\n\n### ğŸ¨ Indicadores Visuales\n\n- **Colores inteligentes**: \n  - ğŸ”µ Azul (Primary): Acciones disponibles\n  - ğŸŸ¡ Amarillo (Warning): En progreso\n  - ğŸŸ¢ Verde (Success): Completado/Listo para entregar\n  - ğŸ”´ Rojo (Error): Cancelado/Error\n  - âš« Gris: No disponible/Esperando\n\n- **Iconos contextuales**:\n  - â° `clock`: Esperando\n  - âœ… `check-circle`: Confirmado/Completado\n  - ğŸ“¦ `package`: Listo para recoger\n  - ğŸ§­ `navigation`: En camino\n  - âŒ `x-circle`: Cancelado\n  - â“ `help-circle`: Estado desconocido\n\n### ğŸš¨ Alertas Inteligentes\n\n- **Dependencias de negocio**: Muestra \"âš ï¸ Requiere acciÃ³n del negocio\" cuando aplica\n- **Mensajes contextuales**: Explica exactamente quÃ© estÃ¡ pasando\n- **PrÃ³ximos pasos**: Indica quÃ© hacer a continuaciÃ³n\n\n## Uso del Componente\n\n### ImportaciÃ³n\n```typescript\nimport { SmartOrderButton } from '@/components/SmartOrderButton';\n```\n\n### Uso BÃ¡sico\n```typescript\n<SmartOrderButton\n  orderStatus=\"ready\"\n  userRole=\"delivery_driver\"\n  onPress={(canProceed, buttonInfo) => {\n    if (canProceed) {\n      // El repartidor puede actuar\n      handleOrderAction(buttonInfo);\n    } else {\n      // Mostrar informaciÃ³n de por quÃ© no puede actuar\n      showStatusInfo(buttonInfo);\n    }\n  }}\n  showStatusInfo={true}\n/>\n```\n\n### Propiedades\n\n| Prop | Tipo | DescripciÃ³n | Default |\n|------|------|-------------|----------|\n| `orderStatus` | `string` | Estado actual del pedido | - |\n| `userRole` | `string` | Rol del usuario actual | `'delivery_driver'` |\n| `onPress` | `function` | Callback cuando se presiona el botÃ³n | - |\n| `showStatusInfo` | `boolean` | Mostrar informaciÃ³n de estado | `true` |\n| `disabled` | `boolean` | Deshabilitar el botÃ³n | `false` |\n\n## ValidaciÃ³n de Estados\n\n### Sistema Centralizado\nEl archivo `utils/orderStateValidation.ts` contiene:\n\n- **Estados vÃ¡lidos**: DefiniciÃ³n de todos los estados posibles\n- **Transiciones**: QuÃ© cambios de estado son permitidos\n- **Roles**: QuÃ© roles pueden realizar cada transiciÃ³n\n- **Mensajes**: Textos contextuales para cada estado\n\n### Funciones Principales\n\n```typescript\n// Obtener informaciÃ³n inteligente del botÃ³n\nconst buttonInfo = getSmartButtonInfo(orderStatus, userRole);\n\n// Validar si una transiciÃ³n es vÃ¡lida\nconst isValid = isValidTransition(fromState, toState, userRole);\n\n// Obtener prÃ³ximas acciones vÃ¡lidas\nconst nextActions = getValidNextActions(currentState, userRole);\n```\n\n## Flujo de Estados para Repartidores\n\n```mermaid\ngraph TD\n    A[pending] -->|Negocio acepta| B[confirmed]\n    B -->|Negocio prepara| C[preparing]\n    C -->|Negocio marca listo| D[ready]\n    D -->|Repartidor recoge| E[picked_up]\n    E -->|Repartidor sale| F[on_the_way]\n    F -->|Repartidor entrega| G[delivered]\n    \n    A -->|CancelaciÃ³n| H[cancelled]\n    B -->|CancelaciÃ³n| H\n    C -->|CancelaciÃ³n| H\n    \n    style D fill:#e1f5fe\n    style E fill:#fff3e0\n    style F fill:#fff3e0\n    style G fill:#e8f5e8\n    style H fill:#ffebee\n```\n\n## Beneficios\n\n### Para Repartidores\n- âœ… **Claridad total**: Siempre saben quÃ© estÃ¡ pasando\n- âœ… **Sin confusiÃ³n**: No pueden hacer acciones invÃ¡lidas\n- âœ… **InformaciÃ³n proactiva**: Saben quÃ© esperar y cuÃ¡ndo\n- âœ… **Menos errores**: El sistema previene acciones incorrectas\n\n### Para Desarrolladores\n- âœ… **CÃ³digo limpio**: LÃ³gica centralizada y reutilizable\n- âœ… **FÃ¡cil mantenimiento**: Un solo lugar para cambiar comportamientos\n- âœ… **Consistencia**: Misma lÃ³gica en toda la aplicaciÃ³n\n- âœ… **Extensible**: FÃ¡cil agregar nuevos estados o roles\n\n### Para el Negocio\n- âœ… **Menos soporte**: Usuarios entienden mejor el proceso\n- âœ… **Mejor experiencia**: Interfaz mÃ¡s intuitiva y Ãºtil\n- âœ… **Menos errores**: PrevenciÃ³n de acciones incorrectas\n- âœ… **Transparencia**: Usuarios saben exactamente quÃ© estÃ¡ pasando\n\n## Ejemplo de ImplementaciÃ³n\n\n```typescript\n// En DriverMyDeliveriesScreen.tsx\n<SmartOrderButton\n  orderStatus={order.status}\n  userRole=\"delivery_driver\"\n  onPress={(canProceed, buttonInfo) => {\n    if (canProceed) {\n      // Mostrar confirmaciÃ³n y proceder\n      Alert.alert(\n        \"Confirmar AcciÃ³n\",\n        buttonInfo.nextAction,\n        [\n          { text: \"Cancelar\", style: \"cancel\" },\n          { text: \"Confirmar\", onPress: () => updateOrderStatus(order.id, getNextStatus(order.status)) }\n        ]\n      );\n    } else {\n      // Mostrar informaciÃ³n de por quÃ© no puede proceder\n      Alert.alert(\n        \"Estado del Pedido\",\n        `${buttonInfo.message}\\n\\n${buttonInfo.nextAction}`,\n        [{ text: \"Entendido\" }]\n      );\n    }\n  }}\n/>\n```\n\n## Notas de ImplementaciÃ³n\n\n- **Sin acciones reales**: Actualmente los botones solo muestran informaciÃ³n, no realizan cambios de estado\n- **Preparado para el futuro**: La estructura estÃ¡ lista para conectar con APIs reales\n- **ValidaciÃ³n robusta**: Previene estados invÃ¡lidos y transiciones incorrectas\n- **Experiencia consistente**: Misma lÃ³gica en todas las pantallas de la aplicaciÃ³n\n\n---\n\n*Este sistema fue diseÃ±ado para mejorar la experiencia del usuario y reducir la confusiÃ³n sobre el estado de los pedidos.*"